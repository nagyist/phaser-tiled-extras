Phaser.Plugin.Triggers=function(r,e){this.game=r,this.name="triggers",this.map=null,this.parent=e},Phaser.Plugin.Triggers.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Triggers.prototype.constructor=Phaser.Plugin.Triggers,Phaser.Plugin.Triggers.prototype.postUpdate=function(){var r=this.map;if(r.hasOwnProperty("triggers"))for(var e in r.triggers)r.triggers[e].enabled&&r.triggers[e].callback&&r.triggers[e].callback(r.triggers[e],null,!0),r.triggers[e].newLoop=!0},Phaser.Tilemap.prototype.setCurrentMap=function(){var r=this.game;for(var e in r.plugins.plugins)if(r.plugins.plugins[e].hasOwnProperty("name")&&"triggers"===r.plugins.plugins[e].name)return void(r.plugins.plugins[e].map=this)},Phaser.Tilemap.prototype.getTriggerByName=function(r){return r in this.triggerNames?this.triggerNames[r]:!1},Phaser.Tilemap.prototype.checkTriggers=function(r){var e,i,t;if(!this.hasOwnProperty("triggers"))return void console.warn("checkTriggers called before defineTriggers!");if(this.triggers){switch(r.type){case 0:e={x:0,y:0},i=[r];break;case 7:e={x:r.x,y:r.y},i=r.children}for(var s in i){r=i[s];var t={left:r.body.position.x,right:r.body.position.x+r.body.width-(Math.abs(r.width)-r.body.width),top:r.body.position.y,bottom:r.body.position.y+r.body.height-(Math.abs(r.height)-r.body.height),anchorX:r.x,anchorY:r.y};for(var g in this.triggers)if(this.triggers[g].enabled){if(this.triggers[g].required)switch(this.triggers[g].required.operator){case"==":if(r[this.triggers[g].required.property]!=this.triggers[g].required.value)continue;break;case"!=":if(r[this.triggers[g].required.property]!=this.triggers[g].required.value)continue;break;case"<=":if(r[this.triggers[g].required.property]>this.triggers[g].required.value)continue;break;case">=":if(r[this.triggers[g].required.property]<this.triggers[g].required.value)continue;break;case"<":if(r[this.triggers[g].required.property]>=this.triggers[g].required.value)continue;break;case">":if(r[this.triggers[g].required.property]<=this.triggers[g].required.value)continue}this.triggers[g].newLoop&&(this.triggers[g].wasTrigged=this.triggers[g].trigged,this.triggers[g].endorsers=[],this.triggers[g].newLoop=!1),t.anchorX<this.triggers[g].area.x2&&t.anchorX>this.triggers[g].area.x&&t.anchorY<this.triggers[g].area.y2&&t.anchorY>this.triggers[g].area.y?(this.triggers[g].trigged=!0,this.triggers[g].endorsers.push(r),this.triggers[g].callback&&this.triggers[g].callback(this.triggers[g],r)):this.triggers[g].wasTrigged&&0===this.triggers[g].endorsers.length&&(this.triggers[g].trigged=!1,this.triggers[g].callback&&this.triggers[g].callback(this.triggers[g],r))}}}},Phaser.Tilemap.prototype.defineTriggers=function(){if(this.setCurrentMap(),!this.objects.hasOwnProperty("triggers"))return this.triggers=null,void(this.triggerNames=null);this.triggers=[],this.triggerNames=[];for(var r,e,i=this.objects.triggers,t=null,s=0,g=i.length;g>s;s++){r={},e=Object.keys(i[s].properties);var a={name:i[s].hasOwnProperty("name")?i[s].name:null,enabled:!i[s].properties.hasOwnProperty("enabled")||"true"!==i[s].properties.enabled,callback:null,args:[],area:{x:i[s].x,y:i[s].y,width:i[s].width,height:i[s].height,x2:i[s].x+i[s].width,y2:i[s].y+i[s].height},trigged:!1,wasTrigged:!1,endorsers:[],detectAnchorOnly:i[s].properties.detectAnchorOnly,required:null,_resetEndorsers:!0};for(var n in e)"callback"!==e[n]&&"required"!==e[n]&&(r[e[n]]=i[s].properties[e[n]]);if(a.args=r,i[s].properties.hasOwnProperty("required")){for(var o=["<=",">=","==","<",">","!=",!1],n=0;7>n&&!(i[s].properties.required.indexOf(o[n])>-1);n++);o[n]&&(t=i[s].properties.required.split(o[n]),t[1]=t[1].replace(/\"/g,"").replace(/\'/g,""),parseFloat(t[1])==t[1]&&(t[1]=parseFloat(t[1])),a.required={property:t[0],operator:o[n],value:"true"===t[1]?!0:"false"===t[1]?!1:t[1]})}i[s].properties.hasOwnProperty("detectAnchorOnly")?"false"!==i[s].properties.detectAnchorOnly&&(a.detectAnchorOnly=!0):a.detectAnchorOnly=!1;var h=null;if(i[s].properties.hasOwnProperty("callback")){h=window;var l=i[s].properties.callback.split(".");for(var n in l){if(!h.hasOwnProperty(l[n])){h=null,console.warn("Trigger callback not found: "+l[n]);break}h=h[l[n]]}a.callback=h}this.triggers.push(a),i[s].hasOwnProperty("name")&&i[s].name&&(this.triggerNames.hasOwnProperty(i[s].name)?console.warn("Duplicate trigger name: "+i[s].name+"\ngetTriggerByName will fail!"):this.triggerNames[i[s].name]=this.triggers.length-1)}0===this.triggers.length&&(this.triggers=null,this.triggerNames=null)};