Phaser.Tilemap.prototype.addImageLayer=function(e,t){this.setDefault();var a=this.game.cache._tilemaps[this.key].data.layers,o=this.game,r=[];this.hasOwnProperty("imageLayers")||(this.imageLayers=[]);for(var i in a)if("imagelayer"===a[i].type&&(!e||e===a[i].name)){if(t)imageKey=t;else if(a[i].properties.hasOwnProperty("key"))imageKey=a[i].properties.key;else if(o.cache._images.hasOwnProperty(a[i].name))imageKey=a[i].name;else{var s=Object.keys(o.cache._images);for(var p in s)"__default"!==s[p]&&"__missing"!==s[p]&&o.cache._images[s[p]].url.indexOf("/"+a[i].image)>0&&(imageKey=s[p])}if(!imageKey){console.warn("Couldn't decide imageKey!");continue}if(!o.cache._images.hasOwnProperty(imageKey)){console.warn("No image with key:"+imageKey);continue}if(image=o.cache._images[imageKey],object=o.add.tileSprite(a[i].x,a[i].y,image.data.width,image.data.height,imageKey),object.posFixedToCamera={x:!1,y:!1},object.relativePosition={x:object.x,y:object.y},a[i].properties.hasOwnProperty("bottom")&&(object.y=this.heightInPixels-image.data.height+parseInt(a[i].properties.bottom)),a[i].properties.hasOwnProperty("imageRepeat"))switch(a[i].properties.imageRepeat){case"repeat":object.x=0,object.y=0,object.width=o.width,object.height=o.height,object.posFixedToCamera.x=!0,object.posFixedToCamera.y=!0;break;case"repeat-x":object.x=0,object.width=o.width,object.posFixedToCamera.x=!0;break;case"repeat-y":object.y=0,object.width=o.width,object.posFixedToCamera.y=!0}a[i].properties.hasOwnProperty("tint")&&(object.tint=a[i].properties.tint),a[i].properties.hasOwnProperty("scale")&&(object.scale.x=parseFloat(a[i].properties.scale),object.scale.y=parseFloat(a[i].properties.scale),object.width/=object.scale.x,object.height/=object.scale.y),a[i].properties.hasOwnProperty("scale.x")&&(object.scale.x=parseFloat(a[i].properties["scale.x"])),a[i].properties.hasOwnProperty("scale.y")&&(object.scale.y=parseFloat(a[i].properties["scale.y"])),object.displace={x:0,y:0},object.velocity={x:0,y:0},object.offset={x:0,y:0},a[i].properties.hasOwnProperty("velocity")&&(object.velocity.x=parseFloat(a[i].properties.velocity),object.velocity.y=parseFloat(a[i].properties.velocity)),object.velocity.x=a[i].properties.hasOwnProperty("velocity.x")?parseFloat(a[i].properties["velocity.x"]):object.velocity.x,object.velocity.y=a[i].properties.hasOwnProperty("velocity.y")?parseFloat(a[i].properties["velocity.y"]):object.velocity.y,object.alpha=a[i].opacity,object.parallax={x:1,y:1},a[i].properties.hasOwnProperty("parallax")&&parseFloat(a[i].properties.parallax)>0&&(object.parallax={x:parseFloat(a[i].properties.parallax),y:parseFloat(a[i].properties.parallax)}),r.push(object),this.imageLayers.push(object)}return 0===r.length?!1:1===r.length?r[0]:r};
Phaser.Tilemap.prototype.loadSprites=function(e,a,i){e||(e="sprites");var t=!1;keys=Object.keys(this.objects);for(var s in keys)if(keys[s]==e){t=this.objects[keys[s]];break}if(!t)return void console.warn("loadSprites failed to identify layer!");for(var s in t){var r=!1,o=a;if(t[s].gid){if(""!==t[s].type)r=t[s].type;else{var p=this.gidToTileProperties(t[s].gid);p.hasOwnProperty("type")&&(r=p.type)}r&&""!==r&&(console.log("Load"+r),themap.createFromObjects(e,t[s].gid,o,null,!0,null,i,window[r]))}}},Phaser.Tilemap.prototype.gidToTileProperties=function(e){console.log(this);for(var a in this.tilesets)if(this.tilesets[a].containsTileIndex(e))return this.tilesets[a].tileProperties.hasOwnProperty(e-this.tilesets[a].firstgid)?this.tilesets[a].tileProperties[e-this.tilesets[a].firstgid]:!1;console.warn("No tileset contain "+e)},Phaser.Tilemap.prototype.tilePropertyToGid=function(e,a){var i,t,s;for(("undefined"==typeof a||null===a)&&(a="type"),t=0;t<this.tilesets.length;t++)if(this.tilesets[t].hasOwnProperty("tileProperties"))for(i=Object.keys(this.tilesets[t].tileProperties),s=0;s<i.length;s++)if(this.tilesets[t].tileProperties[i[s]].hasOwnProperty(a)&&this.tilesets[t].tileProperties[i[s]][a]===e)return parseInt(i[s],10)+parseInt(this.tilesets[t].firstgid,10);return console.log("Error! No GID found:"+e),!1},Phaser.TilemapLayer.prototype.updateCollision=function(e,i){var t,s=["Up","Right","Down","Left"],r=[!1,!1,!1,!1];a=e?{x:e.x,y:e.y,x1:e.x+e.width,y1:e.y+e.height}:{x:0,y:0,x1:this.map.width,y1:this.map.height};for(var o=a.y;o<a.y1;o++)for(var p=a.x;p<a.x1;p++)if(r=[!1,!1,!1,!1],t=this.map.getTile(p,o,this))if(i)t.collideUp=!1,t.collideRight=!1,t.collideDown=!1,t.collideLeft=!1,t.collides=!1,t.faceTop=!1,t.faceRight=!1,t.faceBottom=!1,t.faceLeft=!1;else{t.properties.hasOwnProperty("collideAll")&&"true"===t.properties.collideAll&&(r=[!0,!0,!0,!0]);for(var l=0;4>l;l++)t.properties.hasOwnProperty("collide"+s[l])&&(r[l]="true"===t.properties["collide"+s[l]]?!0:!1);if(t.flipped&&(r=[r[0],r[3],r[2],r[1]]),t.rotation>0)switch(Math.round(2*t.rotation/Math.PI)){case 1:r=[r[3],r[0],r[1],r[2]];break;case 2:r=[r[2],r[3],r[0],r[1]];break;case 3:r=[r[1],r[2],r[3],r[0]]}t.collideUp=r[0],t.collideRight=r[1],t.collideDown=r[2],t.collideLeft=r[3],t.collides=r[0]||r[1]||r[2]||r[3],t.faceTop=r[0],t.faceRight=r[1],t.faceBottom=r[2],t.faceLeft=r[3]}},Phaser.Plugin.TiledExtras=function(e){this.game=e,this.name="tiledExtras",this.map=null},Phaser.Plugin.TiledExtras.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.TiledExtras.prototype.constructor=Phaser.Plugin.TiledExtras,Phaser.Plugin.TiledExtras.prototype.postUpdate=function(){if(map=this.map,map.hasOwnProperty("triggers"))for(var e in map.triggers)map.triggers[e].enabled&&map.triggers[e].callback&&map.triggers[e].callback(map.triggers[e],null,!0),map.triggers[e].newLoop=!0;if(map.hasOwnProperty("imageLayers"))for(var e in map.imageLayers)map.imageLayers[e].offset.x+=map.imageLayers[e].velocity.x*this.game.time.physicsElapsed,map.imageLayers[e].offset.y+=map.imageLayers[e].velocity.y*this.game.time.physicsElapsed,map.imageLayers[e].posFixedToCamera.x&&(map.imageLayers[e].offset.x+=(map.imageLayers[e].x-map.game.camera.x)*map.imageLayers[e].parallax.x,map.imageLayers[e].x=map.game.camera.x),map.imageLayers[e].posFixedToCamera.y&&(map.imageLayers[e].offset.y+=(map.imageLayers[e].y-map.game.camera.y)*map.imageLayers[e].parallax.y,map.imageLayers[e].y=map.game.camera.y),map.imageLayers[e].tilePosition.x=map.imageLayers[e].offset.x+map.imageLayers[e].displace.x,map.imageLayers[e].tilePosition.y=map.imageLayers[e].offset.y+map.imageLayers[e].displace.y},Phaser.Tilemap.prototype.setDefault=function(){game=this.game;for(var e in game.plugins.plugins)if(game.plugins.plugins[e].hasOwnProperty("name")&&"tiledExtras"===game.plugins.plugins[e].name)return void(game.plugins.plugins[e].map=this)};
Phaser.Plugin.TiledExtras.Triggers=function(r){this.game=r,this.map=map,this.triggers=[],this.triggerNames=[],this._resetTests=!1},Phaser.Tilemap.prototype.getTriggerByName=function(r){return r in this.triggerNames?this.triggerNames[r]:!1},Phaser.Tilemap.prototype.checkTriggers=function(r){var e,t,i;if(!this.hasOwnProperty("triggers"))return void console.warn("checkTriggers called before defineTriggers!");if(this.triggers){switch(r.type){case 0:e={x:0,y:0},t=[r];case 7:e={x:r.x,y:r.y},t=r.children}for(var s in t){r=t[s];var i={leftX:r.x+e.x,topY:r.y+e.y,toX:r.x+e.x,rightX:r.x+e.x,rightY:r.y+e.y,anchorX:r.x+e.x,anchorY:r.y+e.y};for(var g in this.triggers)this.triggers[g].enabled&&(this.triggers[g].newLoop&&(this.triggers[g].wasTrigged=this.triggers[g].trigged,this.triggers[g].endorsers=[],this.triggers[g].newLoop=!1),this.triggers[g].required&&r.hasOwnProperty(this.triggers[g].required.property)&&r[this.triggers[g].required.property]!==this.triggers[g].required.value||this.triggers[g].forbidden&&r.hasOwnProperty(this.triggers[g].forbidden.property)&&r[this.triggers[g].forbidden.property]===this.triggers[g].forbidden.value||(i.anchorX<this.triggers[g].x1&&i.anchorX>this.triggers[g].x0&&i.anchorY<this.triggers[g].y1&&i.anchorY>this.triggers[g].y0?(this.triggers[g].trigged=!0,this.triggers[g].endorsers.push(r),this.triggers[g].callback&&this.triggers[g].callback(this.triggers[g],r)):this.triggers[g].wasTrigged&&0===this.triggers[g].endorsers.length&&(this.triggers[g].trigged=!1,this.triggers[g].callback&&this.triggers[g].callback(this.triggers[g],r))))}}},Phaser.Tilemap.prototype.defineTriggers=function(){if(this.setDefault(),!this.objects.hasOwnProperty("triggers"))return this.triggers=null,void(this.triggerNames=null);this.triggers=[],this.triggerNames=[];for(var r,e,t=this.objects.triggers,i=null,s=null,g=0,h=t.length;h>g;g++){r={},e=Object.keys(t[g].properties);for(var n in e)"callback"!==e[n]&&"required"!==e[n]&&"forbidden"!==e[n]&&(r[e[n]]=t[g].properties[e[n]]);t[g].properties.hasOwnProperty("forbidden")&&(i=t[g].properties.forbidden.split("="),i={property:i[0],value:"true"===i[1]?!0:"false"===i[1]?!1:i[1]}),t[g].properties.hasOwnProperty("detectAnchorOnly")?"false"!==t[g].properties.detectAnchorOnly&&(t[g].properties.detectAnchorOnly=!0):t[g].properties.detectAnchorOnly=!1;var a=null;if(t[g].properties.hasOwnProperty("callback")){a=window;var o=t[g].properties.callback.split(".");for(var n in o){if(!a.hasOwnProperty(o[n])){console.warn("Trigger callback not found: "+o[n]);break}a=a[o[n]]}}this.triggers.push({enabled:!t[g].properties.hasOwnProperty("enabled")||"true"===!t[g].properties.enabled,callback:a,arguments:r,area:{x:t[g].x,y:t[g].y,width:t[g].width,height:t[g].height,x2:t[g].x+t[g].width,y2:t[g].y+t[g].height},x0:t[g].x,y0:t[g].y,width:t[g].width,height:t[g].height,x1:t[g].x+t[g].width,y1:t[g].y+t[g].height,trigged:!1,wasTrigged:!1,endorsers:[],detectAnchorOnly:t[g].properties.detectAnchorOnly,forbidden:i,required:s,newLoop:!0,name:t[g].hasOwnProperty("name")?t[g].name:null}),t[g].hasOwnProperty("name")&&t[g].name&&(this.triggerNames.hasOwnProperty(t[g].name)?console.warn("Duplicate trigger name: "+t[g].name+"\ngetTriggerByName will fail!"):this.triggerNames[t[g].name]=this.triggers.length-1)}0===this.triggers.length&&(this.triggers=null,this.triggerNames=null)};